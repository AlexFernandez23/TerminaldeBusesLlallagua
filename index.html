<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Terminal de Buses Llallagua</title>
    <link rel="stylesheet" href="style.css">
</head>
<body data-page="home">
<div class="hero">
    <canvas id="titulo"></canvas>
    <div class="overlay"></div>
</div>

<main>
    <section class="intro">
    <h2>Bienvenidos</h2>
    <p>
      Bienvenidos a la terminal de buses de Llallagua. Aqu√≠ encontrar√° los servicios, rutas y horarios,
      empresas de transporte, una galer√≠a de im√°genes del sitio y la ubicaci√≥n con n√∫meros de contacto.
    </p>
  </section>
  <div class="wrap">
    <div class="grid">
      <a class="card" data-type="historia"  href="historia.html">
        <div class="info"><strong>Historia</strong><small>Pergamino interactivo</small></div>
        <canvas class="mini3d"></canvas>
      </a>
      <a class="card" data-type="empresas" href="empresas.html">
        <div class="info"><strong>Empresas</strong><small>Rutas y horarios</small></div>
        <canvas class="mini3d" id="empresas3d"></canvas>
      </a>
      <a class="card" data-type="galeria"   href="galeria.html">
        <div class="info"><strong>Galer√≠a</strong><small>Fotos del lugar</small></div>
        <canvas class="mini3d"></canvas>
      </a>
      <a class="card" data-type="ubicacion" href="ubicacion.html">
        <div class="info"><strong>Ubicaci√≥n</strong><small>C√≥mo llegar</small></div>
        <canvas class="mini3d"></canvas>
      </a>
      <a class="card" data-type="modelo"    href="mo.html">
        <div class="info"><strong>Modelo 3D</strong><small>Vista interactiva</small></div>
        <canvas class="mini3d"></canvas>
      </a>
    </div>
  </div>


</main>

<footer>
  <p>&copy; 2025 Terminal de Buses de Llallagua. Todos los derechos reservados.</p>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/108/three.min.js"></script>
<script src="https://threejs.org/examples/js/libs/fontloader.js"></script>
<script src="https://threejs.org/examples/js/geometries/TextGeometry.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.108.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
  window.MICRO3D_CONFIG = {
    glbEmpresas: "bus.glb"   // ‚Üê ajusta esta ruta
  };
</script>

<script>
  // ========= Escena 3D transparente en el hero =========
  var canvas = document.getElementById("titulo");
  var scene  = new THREE.Scene();

  var camera = new THREE.PerspectiveCamera(60, 1, 0.1, 100);
  camera.position.set(0, 0.5, 4.4);

  var renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true, canvas });
  renderer.setClearColor(0x000000, 0);

  function resize3D(){
    var r = canvas.getBoundingClientRect();
    renderer.setSize(r.width, r.height, false);
    camera.aspect = r.width / r.height;
    camera.updateProjectionMatrix();
  }
  resize3D();
  addEventListener("resize", resize3D);

  // Luces base (guardamos referencias para el tema)
  var amb = new THREE.AmbientLight(0xffffff, 0.7);
  scene.add(amb);
  var key = new THREE.PointLight(0xffffff, 3);
  key.position.set(2, 2, 5);
  scene.add(key);

  // Texto 3D
  var textMesh, mat, baseX = 0, baseY = -0.3;
  var loader = new THREE.FontLoader();

  loader.load("https://threejs.org/examples/fonts/helvetiker_bold.typeface.json", function(font){
    var geo = new THREE.TextGeometry("Terminal De Llallagua", {
      font, size: 1.0, height: 0.25,
      bevelEnabled:true, bevelThickness:0.04, bevelSize:0.06, bevelSegments:4
    });
    geo.computeBoundingBox();
    baseX = - (geo.boundingBox.max.x - geo.boundingBox.min.x) / 2;

    mat = new THREE.MeshStandardMaterial({
      color: 0xffd92c,
      emissive: 0xffa500,
      emissiveIntensity: 0.22,
      metalness: 0.55,
      roughness: 0.25
    });

    textMesh = new THREE.Mesh(geo, mat);
    textMesh.position.set(baseX, baseY, 0);
    textMesh.scale.setScalar(0.92);
    scene.add(textMesh);

    // Aplica el tema actual tambi√©n al material
    applyTheme(currentTheme());
  });

  // Movimiento sutil + parallax
  var mx = 0, my = 0, t0 = performance.now();
  addEventListener("mousemove", (e)=>{
    mx = (e.clientX / innerWidth  - 0.5) * 2;
    my = (e.clientY / innerHeight - 0.5) * 2;
  });

  function animate(){
    requestAnimationFrame(animate);
    var t = performance.now() * 0.001;

    if (textMesh){
      textMesh.position.x = baseX + mx * 0.25;
      textMesh.position.y = baseY + Math.sin(t * 1.3) * 0.08 + (-my * 0.10);
      textMesh.rotation.y += ((mx * 0.45) - textMesh.rotation.y) * 0.08;
      textMesh.rotation.x += ((-my * 0.25) - textMesh.rotation.x) * 0.08;

      // Pulso tipo ne√≥n (intensidad modulada por el tema)
      if (mat) mat.emissiveIntensity = emissiveBase + Math.sin(t * 2.1) * emissivePulse;
    }
    camera.position.x += ((mx * 0.20) - camera.position.x) * 0.04;
    camera.position.y += ((0.5 - my * 0.20) - camera.position.y) * 0.04;

    renderer.render(scene, camera);
  }
  animate();

  // ========= Theming por hora (p√°gina + 3D) =========
  var overlayEl = document.querySelector(".hero .overlay");

  // par√°metros del ne√≥n seg√∫n tema
  var emissiveBase = 0.22, emissivePulse = 0.08;

  function currentTheme(){
    const h = new Date().getHours();
    if (h >= 8 && h < 12) return "morning";    // 08:00‚Äì11:59
    if (h >= 12 && h < 18) return "afternoon"; // 12:00‚Äì17:59
    return "night";                             // 18:00‚Äì07:59
  }

  function applyTheme(mode){
    document.documentElement.setAttribute("data-theme", mode);

    if (mode === "morning"){
      // p√°gina
      overlayEl && (overlayEl.style.background = getComputedStyle(document.documentElement).getPropertyValue('--overlay-gradient'));
      // 3D
      amb.intensity = 0.6;
      key.color.set(0xfff1a8);
      key.intensity = 2.5;
      emissiveBase = 0.20; emissivePulse = 0.10;
    }
    else if (mode === "afternoon"){
      overlayEl && (overlayEl.style.background = getComputedStyle(document.documentElement).getPropertyValue('--overlay-gradient'));
      amb.intensity = 0.5;
      key.color.set(0xffffff);
      key.intensity = 2.0;
      emissiveBase = 0.18; emissivePulse = 0.07;
    }
    else { // night
      overlayEl && (overlayEl.style.background = getComputedStyle(document.documentElement).getPropertyValue('--overlay-gradient'));
      amb.intensity = 0.22;
      key.color.set(0xffc700);
      key.intensity = 1.4;
      emissiveBase = 0.32; emissivePulse = 0.12;
    }

    if (mat){
      mat.emissiveIntensity = emissiveBase;
    }
  }

  // Aplica de inicio y re-chequea cada 5 minutos
  applyTheme(currentTheme());
  setInterval(function(){ applyTheme(currentTheme()); }, 5 * 60 * 1000);

  // (Opcional) Tecla T para alternar manualmente y probar
  document.addEventListener('keydown', (e)=>{
    if(e.key.toLowerCase()==='t'){
     const order = ['morning','afternoon','night'];
     const i = order.indexOf(document.documentElement.getAttribute('data-theme')) || 0;
    applyTheme(order[(i+1)%3]);
    }
  });
</script>
 <script>
  // ========= Config: ruta del GLB solo para EMPRESAS =========
  const GLB_URLS = {
    empresas : 'bus.glb' 
  };

  // ===== Inicializa TODAS las tarjetas =====
  document.querySelectorAll('.card').forEach(card=>{
    const type   = card.getAttribute('data-type');
    const canvas = card.querySelector('.mini3d');
    if (!canvas) return;

    // Si es EMPRESAS => usa GLB
    if (type === 'empresas'){
      initMicroGLB(canvas, card, GLB_URLS.empresas);
    } else {
      // Resto: procedurales low-poly
      initMicroProcedural(canvas, card, type);
    }
  });

  // ===== Util com√∫n para renderer/c√°mara =====
  function makeRendererAndCamera(canvas, fov=35){
    const cam = new THREE.PerspectiveCamera(fov, 1, 0.01, 100);
    cam.position.set(2.2, 1.6, 3.0);
    cam.lookAt(0, 0.25, 0);

    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    renderer.setClearColor(0x000000, 0);
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.05;

    function fit(){
      const dpr = Math.min(2, window.devicePixelRatio||1);
      const r = canvas.getBoundingClientRect();
      if (canvas.width !== Math.round(r.width*dpr) || canvas.height !== Math.round(r.height*dpr)){
        renderer.setPixelRatio(dpr);
        renderer.setSize(r.width, r.height, false);
        cam.aspect = r.width / r.height;
        cam.updateProjectionMatrix();
      }
    }
    fit(); new ResizeObserver(fit).observe(canvas); addEventListener('resize', fit);
    return { renderer, cam };
  }

  // ===== Luces comunes =====
  function addCommonLights(scene){
    scene.add(new THREE.AmbientLight(0xffffff, 0.9));
    const key = new THREE.DirectionalLight(0xffffff, 0.95);
    key.position.set(2.2, 2.4, 2.8); scene.add(key);
    const rim = new THREE.DirectionalLight(0xffe07a, 0.7);
    rim.position.set(-2.4, 1.1, -1.6); scene.add(rim);
  }
  function addFakeShadow(scene, radius=1.0){
    const shadow = new THREE.Mesh(
      new THREE.CircleGeometry(radius, 32),
      new THREE.MeshBasicMaterial({ color:0x000000, opacity:0.25, transparent:true })
    );
    shadow.rotation.x = -Math.PI/2;
    shadow.position.y = -0.01;
    scene.add(shadow);
    return shadow;
  }

  // ===== Procedurales (todas excepto Empresas) =====
  function initMicroProcedural(canvas, parentCard, type){
    const scene = new THREE.Scene();
    const { renderer, cam } = makeRendererAndCamera(canvas);
    addCommonLights(scene);
    const shadow = addFakeShadow(scene, 0.95);

    let group = new THREE.Group(); scene.add(group);

    // Modelos por tipo
    if(type === 'ubicacion'){
      const ground = new THREE.Mesh(
        new THREE.CircleGeometry(0.9, 6),
        new THREE.MeshStandardMaterial({ color:0x2b8d4b, metalness:.15, roughness:.65 })
      );
      ground.rotation.x = -Math.PI/2; ground.position.y = -0.02; scene.add(ground);

      const pinStem = new THREE.Mesh(
        new THREE.CylinderGeometry(0.08, 0.12, 0.45, 14),
        new THREE.MeshStandardMaterial({ color:0xff3a3a, metalness:.25, roughness:.45 })
      );
      pinStem.position.y = 0.32;
      const pinHead = new THREE.Mesh(
        new THREE.SphereGeometry(0.16, 20, 16),
        new THREE.MeshStandardMaterial({ color:0xff4444, metalness:.2 })
      );
      pinHead.position.y = 0.58;
      group.add(pinStem, pinHead);
      group.position.set(0.25, 0.08, 0.05);
      group.rotation.y = Math.PI*0.1;
    }

    if(type === 'galeria'){
      const body = new THREE.Mesh(
        new THREE.BoxGeometry(1.1,0.6,0.5),
        new THREE.MeshStandardMaterial({ color:0x222831, metalness:.4, roughness:.5 })
      );
      const grip = new THREE.Mesh(
        new THREE.BoxGeometry(0.25,0.55,0.5),
        new THREE.MeshStandardMaterial({ color:0x1a1f26, metalness:.3, roughness:.5 })
      );
      grip.position.x = -0.68;
      const lens = new THREE.Mesh(
        new THREE.CylinderGeometry(0.22,0.22,0.6,22),
        new THREE.MeshStandardMaterial({ color:0x0b0d10, metalness:.5, roughness:.3 })
      );
      lens.rotation.z = Math.PI/2; lens.position.x = 0.65;
      const ring = new THREE.Mesh(
        new THREE.TorusGeometry(0.23,0.03,12,24),
        new THREE.MeshStandardMaterial({ color:0x3aa6ff, emissive:0x1f6ddc, emissiveIntensity:0.35, metalness:.5, roughness:.2 })
      );
      ring.rotation.y = Math.PI/2; ring.position.x = 0.65;
      group.add(body,grip,lens,ring);
      group.rotation.y = -Math.PI*0.15;
    }

if(type === 'modelo'){
  const parts = [];
  const mat = new THREE.MeshStandardMaterial({
    color:0x3ffff0, emissive:0x00c8ff, emissiveIntensity:0.35,
    metalness:.2, roughness:.15, transparent:true, opacity:0.85
  });
  for(let i=0;i<3;i++){
    const box = new THREE.Mesh(new THREE.BoxGeometry(0.6,0.6,0.6), mat.clone());
    box.position.x = (i-1)*0.9; 
    parts.push(box); group.add(box);
  }
  group.userData.parts = parts;
  group.rotation.y = Math.PI*0.15;

  group.userData.baseY = 0.22;   
  group.position.y = group.userData.baseY;
}

    if(type === 'historia'){
  const matPerg = new THREE.MeshStandardMaterial({
    color: 0xf5deb3, // tono pergamino
    emissive: 0x2c1a00,
    emissiveIntensity: 0.12,
    roughness: 0.45,
    metalness: 0.1
  });

  const rodMat = new THREE.MeshStandardMaterial({
    color: 0xd8c6a0,
    emissive: 0x3b2a08,
    emissiveIntensity: 0.08,
    roughness: 0.35,
    metalness: 0.05
  });

  // cilindro del pergamino
  const scroll = new THREE.Mesh(
    new THREE.CylinderGeometry(0.12, 0.12, 1.2, 32),
    matPerg
  );
  scroll.rotation.z = Math.PI / 2;

  // barras laterales (madera)
  const rod1 = new THREE.Mesh(new THREE.CylinderGeometry(0.06, 0.06, 1.5, 16), rodMat);
  const rod2 = rod1.clone();
  rod1.rotation.z = rod2.rotation.z = Math.PI / 2;
  rod1.position.z = 0.12;
  rod2.position.z = -0.12;

  group.add(scroll, rod1, rod2);

  group.position.y = 0.07;
  group.rotation.x = 0.28;
  group.rotation.y = -0.45;
  group.userData.baseRot = group.rotation.y;

  group.userData.float = true; // activar flotaci√≥n leve
}


    // Hover + animaci√≥n
    let hovering=false;
    parentCard.addEventListener('mouseenter', ()=> hovering = true);
    parentCard.addEventListener('mouseleave', ()=> hovering = false);

    function animate(){
      requestAnimationFrame(animate);
      const t = performance.now()*0.002;
      if (hovering){
        if(type === 'ubicacion'){
          group.position.y = Math.sin(t*1.8)*0.06 + 0.08;
          group.rotation.y += 0.01;
          shadow.scale.setScalar(0.92 + Math.sin(t*1.8)*0.05);
        }
        if(type === 'galeria'){
          group.rotation.y += 0.01;
        }
        if(type === 'modelo'){
          const parts = group.userData.parts || [];
          parts.forEach((p)=>{ p.position.x += (0 - p.position.x)*0.08; });
          group.rotation.y += 0.01;
        }
if(type === 'historia'){
  group.rotation.y += 0.012; // girito elegante
  group.position.y = 0.07 + Math.sin(t)*0.025;
}

      } else {
        if(type === 'modelo'){
          const parts = group.userData.parts || [];
          parts.forEach((p, i)=>{ const target=(i-1)*0.9; p.position.x += (target - p.position.x)*0.08; }); 
        }
if(type === 'historia'){
  const base = group.userData.baseRot || -0.45;
  group.rotation.y += (base - group.rotation.y)*0.08;
  group.position.y += (0.07 - group.position.y)*0.08;
}

      }
      renderer.render(scene, cam);
    }
    animate();
  }

  // ===== GLB (solo Empresas) =====
  function initMicroGLB(canvas, parentCard, glbUrl){
    const scene = new THREE.Scene();
    const { renderer, cam } = makeRendererAndCamera(canvas);
    addCommonLights(scene);
    const shadow = addFakeShadow(scene, 1.0);

    let hovering=false, loaded=false, model=null;

    function loadGLB(){
      if(loaded) return; loaded = true;
      const loader = new THREE.GLTFLoader();
      loader.load(
        glbUrl,
        (gltf)=>{
          model = gltf.scene;

          // Normaliza: centrar y auto-escalar
          const box = new THREE.Box3().setFromObject(model);
          const size = box.getSize(new THREE.Vector3());
          const center = box.getCenter(new THREE.Vector3());
          model.position.sub(center);

          const radius = Math.max(size.x, size.y, size.z) * 0.5;
          const target = 1.2; // radio visual deseado
          const scale  = target / radius;
          model.scale.setScalar(scale);

          // Ajuste de materiales suaves
          model.traverse(o=>{
            if (o.isMesh && o.material){
              if (o.material.metalness !== undefined) o.material.metalness = Math.min(0.6, o.material.metalness);
              if (o.material.roughness !== undefined) o.material.roughness = Math.max(0.2, o.material.roughness);
            }
          });

          // Pose inicial
          model.rotation.y = Math.PI*0.20;
          model.position.y = 0.1;

          scene.add(model);
        },
        undefined,
        (err)=>console.error('Error cargando GLB:', err)
      );
    }

    // Hover
    parentCard.addEventListener('mouseenter', ()=>{ hovering=true; loadGLB(); });
    parentCard.addEventListener('mouseleave', ()=> hovering=false);

    function animate(){
      requestAnimationFrame(animate);
      if(hovering && model){
        const t = performance.now()*0.002;
        model.rotation.y += 0.012;
        model.position.y = 0.1 + Math.sin(t)*0.02;
        shadow.scale.setScalar(0.95 + Math.sin(t)*0.02);
      }
      renderer.render(scene, cam);
    }
    animate();
  }

  </script>
  <!-- ================= ROBOT 3D INTERACTIVO ================ -->
<style>
  #robotCanvas{
    position: fixed;
    right: 20px;
    bottom: 20px;
    width: 320px;
    height: 280px;
    z-index: 9999;  
    pointer-events: auto;
  }

  /* CHAT FLOTANTE */
  #chatBox{
    position: fixed;
    right: 20px;
    bottom: 320px;          /* encima del robot */
    width: 320px;
    max-height: 420px;
    background: #050608;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.12);
    box-shadow: 0 16px 40px rgba(0,0,0,0.85);
    display: none;          /* se muestra al hacer clic en el robot */
    flex-direction: column;
    overflow: hidden;
    z-index: 10000;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }
  #chatHeader{
    padding: 10px 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(135deg,#111827,#020617);
    border-bottom: 1px solid rgba(148,163,184,0.25);
  }
  #chatHeader span{
    font-size: 0.9rem;
    color: #e5e7eb;
    font-weight: 600;
  }
  #chatHeader button{
    background: transparent;
    border: none;
    color: #9ca3af;
    font-size: 1.1rem;
    cursor: pointer;
  }
  #chatBody{
    padding: 10px;
    flex: 1;
    overflow-y: auto;
    background: radial-gradient(circle at top,#0b1120,#020617 55%);
  }
  .chat-msg{
    font-size: 0.8rem;
    padding: 6px 10px;
    border-radius: 10px;
    margin-bottom: 6px;
    max-width: 90%;
  }
  .chat-msg.bot{
    background: rgba(56,189,248,0.12);
    border: 1px solid rgba(56,189,248,0.4);
    color: #e0f2fe;
  }
  .chat-msg.user{
    background: rgba(15,118,110,0.2);
    border: 1px solid rgba(45,212,191,0.5);
    color: #ccfbf1;
    margin-left: auto;
  }
  #chatInputRow{
    display: flex;
    padding: 8px;
    gap: 6px;
    border-top: 1px solid rgba(148,163,184,0.25);
    background: #020617;
  }
  #chatInput{
    flex: 1;
    border-radius: 999px;
    border: 1px solid rgba(75,85,99,0.9);
    background: #020617;
    color: #e5e7eb;
    font-size: 0.8rem;
    padding: 6px 10px;
    outline: none;
  }
  #chatSend{
    border-radius: 999px;
    border: none;
    padding: 6px 10px;
    font-size: 0.8rem;
    cursor: pointer;
    background: linear-gradient(135deg,#22c55e,#06b6d4);
    color: #020617;
    font-weight: 600;
  }
</style>

<canvas id="robotCanvas"></canvas>

<!-- CHAT FLOTANTE -->
<div id="chatBox">
  <div id="chatHeader">
    <span>Asistente virtual</span>
    <button id="chatClose">&times;</button>
  </div>
  <div id="chatBody">
    <div class="chat-msg bot">Hola üëã, soy tu asistente. ¬øEn qu√© te ayudo?</div>
  </div>
  <div id="chatInputRow">
    <input id="chatInput" type="text" placeholder="Escribe tu mensaje...">
    <button id="chatSend">Enviar</button>
  </div>
</div>

<script>
(function(){
  var canvas = document.getElementById("robotCanvas");
  if(!canvas || !window.THREE) return;

  canvas.style.cursor = "pointer";

  // ======== ESCENA ========
  var scene = new THREE.Scene();
  scene.background = null; // transparente

  var camera = new THREE.PerspectiveCamera(
    55,
    (canvas.clientWidth || 320) / (canvas.clientHeight || 280),
    0.1,
    50
  );
  camera.position.set(0, 1.6, 4);

  var renderer = new THREE.WebGLRenderer({
    canvas: canvas,
    antialias: true,
    alpha: true
  });
  renderer.setClearColor(0x000000, 0);
  resize();

  // ======== LUCES (m√°s fuertes + ambiente) ========
  var ambient = new THREE.AmbientLight(0xffffff, 0.35);
  scene.add(ambient);

  var hemi = new THREE.HemisphereLight(0x38bdf8, 0x020617, 1.1);
  scene.add(hemi);

  var dir = new THREE.DirectionalLight(0xffffff, 1.4);
  dir.position.set(4, 6, 3);
  dir.castShadow = false;
  scene.add(dir);

  // ======== PLANO "SUELO" (para el raycaster del mouse) ========
  var floorGeom = new THREE.PlaneGeometry(10, 10);
  var floorMat  = new THREE.MeshStandardMaterial({ color: 0x111827, side: THREE.DoubleSide });
  var floor     = new THREE.Mesh(floorGeom, floorMat);
  floor.rotation.x = -Math.PI / 2;
  floor.position.y = 0;
  floor.visible = false;       // solo para c√°lculos
  scene.add(floor);

  // ======== ROBOT FUTURISTA ========
  var robot = new THREE.Group();
  scene.add(robot);

  // base "antigravedad"
  var baseGeom = new THREE.TorusGeometry(0.8, 0.07, 16, 40);
  var baseMat  = new THREE.MeshStandardMaterial({
    color: 0x020617,
    emissive: 0x0ea5e9,
    emissiveIntensity: 0.5,
    metalness: 0.7,
    roughness: 0.2
  });
  var base = new THREE.Mesh(baseGeom, baseMat);
  base.rotation.x = Math.PI / 2;
  base.position.y = 0.2;
  robot.add(base);

  // cuerpo principal (amarillo)
  var bodyGeom = new THREE.CylinderGeometry(0.6, 0.7, 1.6, 20);
  var bodyMat  = new THREE.MeshStandardMaterial({
    color: 0xfacc15,      // amarillo
    metalness: 0.75,
    roughness: 0.25
  });
  var body = new THREE.Mesh(bodyGeom, bodyMat);
  body.position.y = 1.4;
  body.name = "robotBody";     // para rotarlo con drag
  robot.add(body);

  // franja luminosa en el cuerpo (azul)
  var stripeGeom = new THREE.CylinderGeometry(0.62, 0.72, 0.25, 24);
  var stripeMat  = new THREE.MeshStandardMaterial({
    color: 0x1d4ed8,       // azul
    emissive: 0x3b82f6,    // azul brillante
    emissiveIntensity: 1.0,
    metalness: 0.6,
    roughness: 0.2
  });
  var stripe = new THREE.Mesh(stripeGeom, stripeMat);
  stripe.position.y = 1.4;
  robot.add(stripe);

  // hombros
  var shoulderGeom = new THREE.BoxGeometry(1.6, 0.2, 0.6);
  var shoulderMat  = new THREE.MeshStandardMaterial({
    color: 0x111827,
    metalness: 0.7,
    roughness: 0.3
  });
  var shoulders = new THREE.Mesh(shoulderGeom, shoulderMat);
  shoulders.position.y = 2.1;
  robot.add(shoulders);

  // brazos "mec√°nicos"
  var armGeom = new THREE.BoxGeometry(0.22, 0.9, 0.22);
  var armMat  = new THREE.MeshStandardMaterial({
    color: 0x4b5563,
    metalness: 0.8,
    roughness: 0.35
  });
  var leftArm  = new THREE.Mesh(armGeom, armMat);
  var rightArm = leftArm.clone();
  leftArm.position.set(-0.85, 1.75, 0);
  rightArm.position.set(0.85, 1.75, 0);
  robot.add(leftArm, rightArm);

  // cabeza (clic y seguimiento)
  var headGeom = new THREE.BoxGeometry(0.8, 0.55, 0.55);
  var headMat  = new THREE.MeshStandardMaterial({
    color: 0x020617,
    metalness: 0.9,
    roughness: 0.2
  });
  var head = new THREE.Mesh(headGeom, headMat);
  head.position.y = 2.6;
  head.name = "robotHead";
  robot.add(head);

  // "visor" con ojos LED
  var visorGeom = new THREE.BoxGeometry(0.68, 0.28, 0.05);
  var visorMat  = new THREE.MeshStandardMaterial({
    color: 0x020617,
    emissive: 0x38bdf8,
    emissiveIntensity: 1.2
  });
  var visor = new THREE.Mesh(visorGeom, visorMat);
  visor.position.set(0, 0.02, 0.295);
  head.add(visor);

  var eyeGeom = new THREE.BoxGeometry(0.12, 0.12, 0.04);
  var eyeMat  = new THREE.MeshStandardMaterial({
    color: 0x0f172a,
    emissive: 0x22c55e,
    emissiveIntensity: 1.4
  });
  var eyeL = new THREE.Mesh(eyeGeom, eyeMat);
  var eyeR = eyeL.clone();
  eyeL.position.set(-0.18, 0.02, 0.02);
  eyeR.position.set( 0.18, 0.02, 0.02);
  visor.add(eyeL, eyeR);

  // antena
  var antennaStem = new THREE.Mesh(
    new THREE.CylinderGeometry(0.03, 0.03, 0.35, 12),
    new THREE.MeshStandardMaterial({ color: 0x6b7280, metalness: 0.8, roughness: 0.2 })
  );
  antennaStem.position.set(0, 0.45, 0);
  head.add(antennaStem);

  var antennaTip = new THREE.Mesh(
    new THREE.SphereGeometry(0.07, 16, 16),
    new THREE.MeshStandardMaterial({
      color: 0x22c55e,
      emissive: 0x22c55e,
      emissiveIntensity: 1.3
    })
  );
  antennaTip.position.y = 0.2;
  antennaStem.add(antennaTip);

  robot.position.y = 0.1;

  // ======== RAYCASTER / MOUSE ========
  var mouse = new THREE.Vector2();
  var raycaster = new THREE.Raycaster();
  var headWorldPos = new THREE.Vector3();

  // para drag de rotaci√≥n
  var isDragging = false;
  var dragStartX = 0;
  var startRotationY = 0;

  function updateMouseFromEvent(e){
    var rect = canvas.getBoundingClientRect();
    mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
  }

  canvas.addEventListener("mousemove", function(e){
    updateMouseFromEvent(e);

    if (isDragging) {
      var deltaX = e.clientX - dragStartX;
      robot.rotation.y = startRotationY + deltaX * 0.01;  // factor de giro
    }
  });

  canvas.addEventListener("mousedown", function(e){
    updateMouseFromEvent(e);
    raycaster.setFromCamera(mouse, camera);
    var hit = raycaster.intersectObjects(scene.children, true);
    if(hit.length && hit[0].object.name === "robotBody"){
      isDragging = true;
      dragStartX = e.clientX;
      startRotationY = robot.rotation.y;
    }
  });

  canvas.addEventListener("mouseup", function(){
    isDragging = false;
  });
  canvas.addEventListener("mouseleave", function(){
    isDragging = false;
  });

  // click para abrir/cerrar chat (en la cabeza)
  canvas.addEventListener("click", function(e){
    updateMouseFromEvent(e);
    raycaster.setFromCamera(mouse, camera);
    var hit = raycaster.intersectObjects(scene.children, true);
    if(hit.length && hit[0].object.name === "robotHead"){
      openChatWindow();   // toggle del chat
    }
  });

  // ======== CHAT ========
  var chatBox   = document.getElementById("chatBox");
  var chatClose = document.getElementById("chatClose");
  var chatInput = document.getElementById("chatInput");
  var chatSend  = document.getElementById("chatSend");
  var chatBody  = document.getElementById("chatBody");

  // Toggle: si est√° abierto se cierra, si est√° cerrado se abre
  function openChatWindow(){
    if(!chatBox) return;

    if (chatBox.style.display === "flex") {
      chatBox.style.display = "none";
      return;
    }

    chatBox.style.display = "flex";
    chatInput && chatInput.focus();
  }

  if(chatClose){
    chatClose.addEventListener("click", function(){
      chatBox.style.display = "none";
    });
  }

  function appendMsg(text, who){
    if(!chatBody) return;
    var div = document.createElement("div");
    div.className = "chat-msg " + (who || "bot");
    div.textContent = text;
    chatBody.appendChild(div);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  function sendUserMessage(){
    if(!chatInput || !chatInput.value.trim()) return;
    var msg = chatInput.value.trim();
    appendMsg(msg, "user");
    chatInput.value = "";
    // Aqu√≠ luego llamas a tu backend / IA.
    setTimeout(function(){
      appendMsg("Esta ser√≠a la respuesta de la IA a: \"" + msg + "\"", "bot");
    }, 400);
  }

  if(chatSend){
    chatSend.addEventListener("click", sendUserMessage);
  }
  if(chatInput){
    chatInput.addEventListener("keydown", function(e){
      if(e.key === "Enter") sendUserMessage();
    });
  }

  // ======== ANIMACI√ìN ========
  function animate(){
    requestAnimationFrame(animate);

    var t = performance.now() * 0.001;

    // efecto flotante y peque√±os movimientos
    robot.position.y = 0.1 + Math.sin(t * 2) * 0.06;
    leftArm.rotation.z  = Math.sin(t * 2.4) * 0.25;
    rightArm.rotation.z = -Math.sin(t * 2.4) * 0.25;
    antennaTip.position.y = 0.2 + Math.sin(t * 5) * 0.03;

    // cabeza sigue al mouse (giro horizontal)
    raycaster.setFromCamera(mouse, camera);
    var hits = raycaster.intersectObject(floor);
    if(hits.length){
      var point = hits[0].point;
      head.getWorldPosition(headWorldPos);
      var dx = point.x - headWorldPos.x;
      var dz = point.z - headWorldPos.z;
      var targetYaw = Math.atan2(dx, dz);        // izquierda/derecha
      head.rotation.y += (targetYaw - head.rotation.y) * 0.18; // suavizado
    }

    renderer.render(scene, camera);
  }
  animate();

  // ======== RESIZE ========
  function resize(){
    var w = canvas.clientWidth || 320;
    var h = canvas.clientHeight || 280;
    renderer.setSize(w, h, false);
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
  }
  window.addEventListener("resize", resize);
})();
</script>


</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modelo 3D - Terminal de Buses Llallagua</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; }
    canvas { display:block; }
    .home-button{
      position:fixed; top:20px; left:20px; z-index:1000;
      background:linear-gradient(135deg,#6a11cb 0%,#2575fc 100%);
      color:#fff; border:none; border-radius:50px; padding:12px 24px;
      font-size:16px; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:8px;
      box-shadow:0 4px 15px rgba(0,0,0,.2);
    }
  </style>
</head>
<body>
  <button class="home-button" onclick="window.location.href='index.html'">Volver al Inicio</button>

  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>


  <!-- <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/libs/draco/draco_decoder.js"></script> -->

  <script>
    // --- Escena ---
    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 5000);
    camera.position.set(10, 10, 25);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // --- Controles ---
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    const textureLoader = new THREE.TextureLoader();
    textureLoader.load("../img/llallagua.jpeg", function(texture) {
      texture.encoding = THREE.sRGBEncoding;

      const backgroundMesh = new THREE.Mesh(
        new THREE.PlaneGeometry(2, 2),
        new THREE.MeshBasicMaterial({ map: texture, transparent: true, opacity: 0.5 })
      );
      const backgroundScene = new THREE.Scene();
      const backgroundCamera = new THREE.Camera();
      backgroundScene.add(backgroundMesh);
      backgroundMesh.material.depthTest = false;
      backgroundMesh.material.depthWrite = false;

      function animateBG() {
        requestAnimationFrame(animateBG);
        renderer.autoClear = false;
        renderer.clear();
        renderer.render(backgroundScene, backgroundCamera);
        renderer.render(scene, camera);
        controls.update();
      }
      animateBG();
    }, undefined, () => {
      animate();
    });

    // --- Luces estilo “estudio” ---
    const ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
    directionalLight.position.set(15, 20, 15);
    directionalLight.castShadow = true;
    scene.add(directionalLight);

    // --- Cargar tu modelo GLB: terminal.glb ---
    const loader = new THREE.GLTFLoader();

    loader.load(
      'terminal.glb', 
      function(gltf) {
        const model = gltf.scene;

        model.scale.set(20, 20, 20);


        const box = new THREE.Box3().setFromObject(model);
        const center = box.getCenter(new THREE.Vector3());
        model.position.addScaledVector(center, -1); 

        // Opcionalun leve giro inicial si quieres
        // model.rotation.y = Math.PI * 0.15;

        model.traverse(o => {
          if (o.isMesh) {
            o.castShadow = true;
            o.receiveShadow = true;
            // o.material = new THREE.MeshStandardMaterial({ color: 0x888888, metalness:0.2, roughness:0.6 });
          }
        });

        scene.add(model);
      },
      function(xhr) { console.log((xhr.total ? (xhr.loaded / xhr.total * 100).toFixed(0) : '?') + '% cargado'); },
      function(error) { console.error('Error al cargar terminal.glb:', error); alert('No se pudo cargar terminal.glb (mira la consola).'); }
    );

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
      controls.update();
    }

    window.addEventListener('resize', function() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
